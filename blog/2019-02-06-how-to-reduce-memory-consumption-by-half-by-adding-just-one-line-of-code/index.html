<!DOCTYPE HTML>

<html>

    <head>

	<script defer="defer" async="async" src="https://www.googleoptimize.com/optimize.js?id=OPT-52RT2BV"></script>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "/"
        },
        "articleSection" : "blog",
        "name" : "Giảm bộ nhớ sử dụng trong python",
        "headline" : "Giảm bộ nhớ sử dụng trong python",
        "description" : "Python là ngôn ngữ kịch bản được phát triển kể từ năm 1991. Ở một số thực nghiệm, ta thấy rằng python &#34;ăn&#34; rất nhiều RAM. Ở bài viết này, chúng ta sẽ phân tích sâu hơn về vì sao python lại ăn ram và cách khắc phục.",
        "inLanguage" : "en",
        "author" : "alexblack2202@gmail.comPhạm Duy Tùng",
        "creator" : "alexblack2202@gmail.comPhạm Duy Tùng",
        "publisher": "alexblack2202@gmail.comPhạm Duy Tùng",
        "accountablePerson" : "alexblack2202@gmail.comPhạm Duy Tùng",
        "copyrightHolder" : "alexblack2202@gmail.comPhạm Duy Tùng",
        "copyrightYear" : "2019",
        "datePublished": "2019-02-06 00:19:00 &#43;0300 &#43;0300",
        "dateModified" : "2019-02-06 00:19:00 &#43;0300 &#43;0300",
        "url" : "/blog/2019-02-06-how-to-reduce-memory-consumption-by-half-by-adding-just-one-line-of-code/",
        "wordCount" : "1142",
        "keywords" : [ "Machine learning","Deeplearning","python","Blog" ]
    }
    </script>
        
            
                <title>Giảm bộ nhớ sử dụng trong python</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        
		<meta name="generator" content="Phạm Duy Tùng" />
        <meta property="fb:pages" content="1244186728962161" />

        
  
    
  

  

  
  
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta name="msapplication-tooltip" content="Blog ML của Phạm Duy Tùng và Đặng Thị Hằng">
   
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">



        
            <meta name="author" content="Phạm Duy Tùng">
        
        
            <meta name="description" content="Python là ngôn ngữ kịch bản được phát triển kể từ năm 1991. Ở một số thực nghiệm, ta thấy rằng python &#34;ăn&#34; rất nhiều RAM. Ở bài viết này, chúng ta sẽ phân tích sâu hơn về vì sao python lại ăn ram và cách khắc phục.">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Giảm bộ nhớ sử dụng trong python"/>
<meta name="twitter:description" content="Python là ngôn ngữ kịch bản được phát triển kể từ năm 1991. Ở một số thực nghiệm, ta thấy rằng python &#34;ăn&#34; rất nhiều RAM. Ở bài viết này, chúng ta sẽ phân tích sâu hơn về vì sao python lại ăn ram và cách khắc phục."/>
<meta name="twitter:site" content="@example"/>

        <meta property="og:title" content="Giảm bộ nhớ sử dụng trong python" />
<meta property="og:description" content="Python là ngôn ngữ kịch bản được phát triển kể từ năm 1991. Ở một số thực nghiệm, ta thấy rằng python &#34;ăn&#34; rất nhiều RAM. Ở bài viết này, chúng ta sẽ phân tích sâu hơn về vì sao python lại ăn ram và cách khắc phục." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2019-02-06-how-to-reduce-memory-consumption-by-half-by-adding-just-one-line-of-code/" /><meta property="article:published_time" content="2019-02-06T00:19:00&#43;03:00"/>
<meta property="article:modified_time" content="2019-02-06T00:19:00&#43;03:00"/>

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        
<meta itemprop="name" content="Giảm bộ nhớ sử dụng trong python">
<meta itemprop="description" content="Python là ngôn ngữ kịch bản được phát triển kể từ năm 1991. Ở một số thực nghiệm, ta thấy rằng python &#34;ăn&#34; rất nhiều RAM. Ở bài viết này, chúng ta sẽ phân tích sâu hơn về vì sao python lại ăn ram và cách khắc phục.">


<meta itemprop="datePublished" content="2019-02-06T00:19:00&#43;03:00" />
<meta itemprop="dateModified" content="2019-02-06T00:19:00&#43;03:00" />
<meta itemprop="wordCount" content="1142">



<meta itemprop="keywords" content="Machine learning,Deeplearning,python," />

        

        
            
        

        
        
          
			 <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">


          
            
        

        
            
                
            
        


  
    
    <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/styles/xcode.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-114911596-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

	  <style>
	  
	  body{
font-family: Helvetica,Arial,sans-serif;
}

.card{
	margin-bottom: 10px;
}

#disqus_thread{
padding: 0 5px;
}

.item-header{
padding: 0;
}

.single-content-img{
width: 100%;
    max-height: 450px !important;
    background-size: cover;
    display: block;
    background-position: center;
}

.thumbnail {
    position: relative;
}

.caption {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
	background: rgba(0, 0, 0, 0.25);
	text-align:left;
}

.caption .title{
	font-size: 1.6em;
    line-height: 1.4em;
    top: 0;
	margin-left:20px;
	margin-top:20px;
	
}

.caption .title-caption{
margin-left:10px;
}

#content p{
text-align: justify;
    font-size: 16px;
    <!-- color: #333;-->	
    line-height: 28px;
}

#content img{
	display: block;
    margin-left: auto;
margin-right: auto;
max-width:98%;
}

img + strong {
    font-style: normal;
    display: inherit;
    text-align: center;
}
.img-news{
max-height:150px;
width:100%;
}

.news-tittle{
	padding-top:15px;
	text-align:justify;
}

.author{
	color: orange;
}
.author-inline{
	color: orange;
}

.adv{
height:18px;
}


.hljs{
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;}
.titledetail {
    display: block;
    overflow: hidden;
    line-height: 53px;
    font-size: 45px;
    font-family: 'Roboto Condensed',sans-serif;
    font-weight: 600;

    margin: auto;
	padding: 0 ;
}

.newsrelate {
    display: block;
    overflow: hidden;
	 list-style:none;
}
a ,a:hover{
    text-decoration: none;
}
.newsrelate li {
    float: left;
    overflow: hidden;
    width: 30%;
    margin-left: 2.5%;
    margin-bottom: 15px;
}

.newsrelate li a {
    display: block;
    overflow: hidden;
}

.userdetail {
    display: block;
    overflow: hidden;
    margin: 0 10px 0 0;
    padding: 15px 0;
}
.newsrelate li h3 {
    display: block;
    overflow: hidden;
    line-height: 1.3em;
    font-size: 16pt;
    line-height: 22px;
    font-weight: 300;
    font-family: Arial,Helvetica,sans-serif;
    width: auto;
    margin: 5px auto;
}

.titlerelate {
    overflow: hidden;
    font-size: 18px;
    font-weight: 600;
    font-family: 'Roboto Condensed',sans-serif;
    line-height: 32px;
    text-transform: uppercase;
}
article .captionnews {
    color: #999;
    font-size: 14px;
    font-style: italic;
    padding: 10px;
    text-align: center;
    margin-bottom: 15px;
}

.bgtrans h1 {
    display: block;
    overflow: hidden;
    font-size: 45px;
    line-height: 55px;
    margin: auto;
    left: 0;
    right: 0;
    bottom: 50px;
    font-family: 'Roboto Condensed',sans-serif;
    font-weight: 600;
}

.bgcover {
    display: block;
    overflow: hidden;
    height: 450px;
    background: no-repeat center center;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
    position: relative;
    margin-bottom: -65px;
}
.bgcover .bgtrans .userdetail {
    width: 800px;
    margin: auto;
    position: absolute;
    left: 0;
    right: 0;
    bottom: 10px;
}
.userdetail {
    display: block;
    overflow: hidden;
    margin: 0 10px 0 0;
    padding: 15px 0;
}

.amlich{border-collapse:collapse;font-size:14px;font-family:Roboto,sans-serif}.calendar{font-size:12px}.calendar td{background-color:#e9eff3}.calendar-month{background-color:#1e8cbe!important;color:#fff;text-shadow:0 0 3px #000;padding:6px;font-weight:700;text-transform:uppercase;font-size:14px!important}.amlich-tennam{text-align:center;font-weight:700;color:#000;background-color:#ccc;font-size:14px;font-family:Roboto,sans-serif}.amlich .calendar-month,.amlich .calendar-b-left,.amlich .calendar-b-right{text-align:center;padding:4px 0;font-size:11px}.amlich .calendar-day{text-align:center;font-weight:700}.amlich .calendar-day .day-num{font-size:80px;font-family:Roboto,sans-serif;line-height:100%;color:#31708f}.amlich .lunar-day-num{font-size:44px;line-height:100%;font-weight:700;color:#3c763d}.amlich .calendar-holiday,.amlich .calendar-hoangdao{padding:0 4px 4px;font-size:11px;text-align:center}.amlich .calendar-holiday{color:#a94442;font-weight:700}.amlich a{text-decoration:none;color:#fff}.amlich a:hover{color:red}.amlich .tenthang,.amlich .navi-l,.amlich .navi-r{text-align:center;padding:6px;background-color:#1e8cbe;color:#fff;font-weight:700}.amlich .tenthang{text-shadow:0 0 3px #000}.amlich .navi-l{font-size:12px}.amlich .navi-r{font-size:12px}.amlich .ngaytuan{text-align:center;color:#303;background-color:#ddd;padding:3px;width:14.286%;font-size:10px;font-weight:700}.amlich .ngaythang,.amlich .homnay,.amlich .tet,.amlich .leam,.amlich .leduong{cursor:pointer;border-bottom:solid 1px #eee;padding:3px;width:14.286%}.amlich .ngaythang div,.amlich .homnay div,.amlich .tet div,.amlich .leam div,.amlich .leduong div{line-height:110%}.amlich .ngaythang{color:#5a5c5b}.amlich tr:nth-child(odd) td.ngaythang:nth-child(odd){background-color:#f9f9f9}.amlich tr:nth-child(odd) td.ngaythang:nth-child(even){background-color:#fff}.amlich tr:nth-child(even) td.ngaythang:nth-child(odd){background-color:#fff}.amlich tr:nth-child(even) td.ngaythang:nth-child(even){background-color:#f9f9f9}.amlich tr td.ngaythang:hover{background-color:#f5f5f5!important}.amlich .homnay{background-color:#fcf8e3;color:#fff}.amlich .homnay:hover{background-color:#faf2cc}.amlich .tet{background-color:#f2dede}.amlich .tet:hover{background-color:#ebcccc}.amlich .leam{background-color:#d9edf7}.amlich .leam:hover{background-color:#c4e3f3}.amlich .leduong{background-color:#dff0d8}.amlich .leduong:hover{background-color:#d0e9c6}.amlich .am{text-align:right;font-size:75%;color:#554c00}.amlich .am2{text-align:right;font-size:75%;color:#337ab7;font-weight:700}.amlich .t2t6{text-align:left;color:#5a5c5b;font-weight:700}.amlich .t7{font-weight:700;text-align:left;color:blue}.amlich .cn{font-weight:700;text-align:left;color:red}
	  </style>

    </head>
    <body class="text-dark bg-light">
<script  async defer>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1546237302193677',
      xfbml      : true,
      version    : 'v5.0'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v5.0&appId=1853483258232756&autoLogAppEvents=1"></script>
      
      

    
    
<header id="header"  style="background: #790014; color: hsla(0,0%,100%,1);">
<div class="container">
    <nav class="navbar navbar-expand-md navbar-dark">
	
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            
                <li class="nav-item">
                    <a class='nav-link' href="/blog">
                            <i class="fa fa-home active">&nbsp;</i>Home
                    </a>
                </li>
            
        </ul>
    </nav>
    </div></div>
</header>


   
    
	<div class="container">
	<div class="adv"></div>
	<div class="row">
    <main role="main"  class="col-md-9 border-right" >
	
        
        
          


        
		 <div class="header">
           
		<div class="bgtrans">
		 <h1 class="titledetail">Giảm bộ nhớ sử dụng trong python</h1>
		<div class="userdetail">
			 
			  <time class="published" 
            datetime='2019-02-06'>
            06/02/2019</time>
		 - 
			   <span class="author">Phạm Duy Tùng</span>
			   
			</div>	
		
			</div>
			</div>
  <div class="fb-like" data-share="true"  data-width="800"  data-show-faces="true">
</div>
			
		
		
			 
            
        
       



  

  
 
  <div style="    margin: 0;
    border-bottom: 1px dotted #d9d9d9;
    padding-bottom: 20px;"></div>
  <div id="content">
    

<h2 id="mở-đầu">Mở đầu</h2>

<p>Bắt đầu bằng một class đơn giản như sau:</p>

<pre><code class="language-python">class DataItem(object):
    def __init__(self, name, age, address):
        self.name = name
        self.age = age
        self.address = address
</code></pre>

<p>Bạn nghĩ một đối tượng của class trên sẽ chiếm bao nhiêu bộ nhớ. Chúng ta cùng tiến hành một vài thí nghiệm nho nhỏ bên dưới.</p>

<pre><code class="language-python">dx = DataItem(&quot;Alex Black&quot;, 42, &quot;-&quot;)
print (&quot;sys.getsizeof(dx):&quot;, sys.getsizeof(dx))
&gt;&gt; sys.getsizeof(dx): 56
</code></pre>

<p>Kết quả ra là <em>56 bytes</em>, khá hợp lý phải không các bạn. Thử với một ví dụ khác xem sao nhỉ.</p>

<pre><code class="language-python">dy = DataItem(&quot;Alex Black&quot;, 42, &quot;I am working at MWG&quot;)
print (&quot;sys.getsizeof(dy):&quot;, sys.getsizeof(dy))
&gt;&gt; sys.getsizeof(dy): 56
</code></pre>

<p>Kết quả vẫn là <em>56 bytes</em>. Có cái gì đó sai sai ở đây không nhỉ?</p>

<p>Chúng ta thực nghiệm một vài thí nghiệm khác để chứng thực.</p>

<pre><code class="language-python">print (sys.getsizeof(&quot;&quot;))
&gt;&gt; 49
print (sys.getsizeof(&quot;1&quot;))
&gt;&gt; 50
print (sys.getsizeof(1))
&gt;&gt; 28
print (sys.getsizeof(dict()))
&gt;&gt; 240
print (sys.getsizeof({}))
&gt;&gt; 240
print (sys.getsizeof(list()))
&gt;&gt; 64
print (sys.getsizeof([]))
&gt;&gt; 64
print (sys.getsizeof(()))
&gt;&gt; 48
</code></pre>

<p>Một điều cực kỳ bất ngờ đã xuất hiện ở đây. Một chuỗi rỗng chiếm đến tận <em>49 bytes</em>, một dictionary rỗng, không chứa phần tử nào chiếm đến <em>240 bytes</em>, và một list rỗng chiếm tới <em>64 bytes</em>. Rõ ràng, python đã lưu một số thứ gì đó ngoài dữ liệu của mình.</p>

<p>Đi sâu vào thử tìm hiểu những thứ &lsquo;linh kiện&rsquo; linh tinh mà python đã kèm theo cho chúng ta là gì nhé.</p>

<p>Đầu tiên, chúng ta sẽ cần một hàm in ra những thứ mà python đã &lsquo;nhúng&rsquo; thêm vào class DataItem chúng ta khai báo ở trên.</p>

<pre><code class="language-python">def dump(obj):
  for attr in dir(obj):
    print(&quot;  obj.%s = %r&quot; % (attr, getattr(obj, attr)))
</code></pre>

<p>và dump biến dy ra thôi</p>

<pre><code class="language-python">dump(dy)

obj.__class__ = &lt;class '__main__.DataItem'&gt;
  obj.__delattr__ = &lt;method-wrapper '__delattr__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__dict__ = {'name': 'Alex Black', 'age': 42, 'address': 'i am working at MWG'}
  obj.__dir__ = &lt;built-in method __dir__ of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__doc__ = None
  obj.__eq__ = &lt;method-wrapper '__eq__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__format__ = &lt;built-in method __format__ of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__ge__ = &lt;method-wrapper '__ge__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__getattribute__ = &lt;method-wrapper '__getattribute__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__gt__ = &lt;method-wrapper '__gt__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__hash__ = &lt;method-wrapper '__hash__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__init__ = &lt;bound method DataItem.__init__ of &lt;__main__.DataItem object at 0x000001A64A6DD0F0&gt;&gt;
  obj.__init_subclass__ = &lt;built-in method __init_subclass__ of type object at 0x000001A64A5DE738&gt;
  obj.__le__ = &lt;method-wrapper '__le__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__lt__ = &lt;method-wrapper '__lt__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__module__ = '__main__'
  obj.__ne__ = &lt;method-wrapper '__ne__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__new__ = &lt;built-in method __new__ of type object at 0x000000005C2DC580&gt;
  obj.__reduce__ = &lt;built-in method __reduce__ of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__reduce_ex__ = &lt;built-in method __reduce_ex__ of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__repr__ = &lt;method-wrapper '__repr__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__setattr__ = &lt;method-wrapper '__setattr__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__sizeof__ = &lt;built-in method __sizeof__ of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__str__ = &lt;method-wrapper '__str__' of DataItem object at 0x000001A64A6DD0F0&gt;
  obj.__subclasshook__ = &lt;built-in method __subclasshook__ of type object at 0x000001A64A5DE738&gt;
  obj.__weakref__ = None
  obj.address = 'i am working at MWG'
  obj.age = 42
  obj.name = 'Alex Black'
</code></pre>

<p>Wow, có vẻ khá là đồ sộ nhỉ.</p>

<p>Trên github, có một hàm có sẵn tính toán số lượng bộ nhớ mà object chiếm được dựa vào cách truy xuất trực tiếp từng trường dữ liệu của đối tượng và tính toán kích thước</p>

<pre><code class="language-python">import sys

def get_size(obj, seen=None):
    &quot;&quot;&quot;Recursively finds size of objects&quot;&quot;&quot;
    size = sys.getsizeof(obj)
    if seen is None:
        seen = set()
    obj_id = id(obj)
    if obj_id in seen:
        return 0
    # Important mark as seen *before* entering recursion to gracefully handle
    # self-referential objects
    seen.add(obj_id)
    if isinstance(obj, dict):
        size += sum([get_size(v, seen) for v in obj.values()])
        size += sum([get_size(k, seen) for k in obj.keys()])
    elif hasattr(obj, '__dict__'):
        size += get_size(obj.__dict__, seen)
    elif hasattr(obj, '__iter__') and not isinstance(obj, (str, bytes, bytearray)):
        size += sum([get_size(i, seen) for i in obj])
    return size
</code></pre>

<p>thử với 2 biến dx và dy của chúng ta xem sao</p>

<pre><code class="language-python">&gt;&gt;&gt; print (&quot;get_size(d1):&quot;, get_size(dx))
get_size(d1): 466
&gt;&gt;&gt; print (&quot;get_size(d1):&quot;, get_size(dy))
get_size(d1): 484
</code></pre>

<p>Chúng tốn lần lượt là 466 và 484 bytes. Có vẻ đúng đó nhỉ.</p>

<p>Điều chúng ta quan tâm lúc này là có cách nào để giảm bộ nhớ tiêu thụ của một object hay không?</p>

<h2 id="giảm-bộ-nhớ-tiêu-thụ-của-một-đối-tượng-trong-python">Giảm bộ nhớ tiêu thụ của một đối tượng trong python</h2>

<p>Tất nhiên là sẽ có cách giảm. Python là một ngôn ngữ thông dịch, và nó cho phép chúng ta mở rộng lớp bất kể lúc nào bằng cách thêm một/ nhiều trường dữ liệu.</p>

<pre><code class="language-python">dz = DataItem(&quot;Alex Black&quot;, 42, &quot;-&quot;)
dz.height = 1.80
print ( get_size(dz))
&gt;&gt; 484
</code></pre>

<p>Chính vì lý do này, trình biên dịch sẽ tốn thêm một đống bộ nhớ tạm để chúng ta có thể dễ dàng mở rộng một lớp trong tương lai. Nếu chúng ta &ldquo;ép buộc&rdquo; trình biên dịch, nói rằng chúng ta chỉ có nhiêu đó trường, và bỏ phần dư thừa đi.</p>

<pre><code class="language-python">class DataItem(object):
    __slots__ = ['name', 'age', 'address']
    def __init__(self, name, age, address):
        self.name = name
        self.age = age
        self.address = address
</code></pre>

<p>Và thử lại</p>

<pre><code class="language-python">
dz = DataItem(&quot;Alex Black&quot;, 42, &quot;i am working at MWG&quot;)
print (&quot;sys.getsizeof(dz):&quot;, get_size(dz))

&gt;&gt;sys.getsizeof(dz): 64
</code></pre>

<p>Các bạn thấy gì không, bộ nhớ tiêu thụ chỉ là &ldquo;64 bytes&rdquo;. Dung lượng đã giảm đi hơn &ldquo;7 lần&rdquo; so với model class ban đầu. Tuy nhiên, chúng ta sẽ không thể mở rộng class dễ dàng như xưa nữa.</p>

<pre><code class="language-python">&gt;&gt;&gt; dz.height = 1.80
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
AttributeError: 'DataItem' object has no attribute 'height'
</code></pre>

<p>Thử tạo một đối tượng có 1000 phần tử và kiểm tra thử.</p>

<pre><code class="language-python">class DataItem(object):
    __slots__ = ['name', 'age', 'address']
    def __init__(self, name, age, address):
        self.name = name
        self.age = age
        self.address = address


data = []

tracemalloc.start()
start =datetime.datetime.now()
for p in range(100000):
    data.append(DataItem(&quot;Alex&quot;, 42, &quot;middle of nowhere&quot;))
    
end =datetime.datetime.now()
snapshot = tracemalloc.take_snapshot()
top_stats = snapshot.statistics('lineno')
total = sum(stat.size for stat in top_stats)
print(&quot;Total allocated size: %.1f MB&quot; % (total / (1024*1024)))
print(&quot;Total execute time:&quot;,(end-start).microseconds)

&gt;&gt; Total allocated size: 6.9 MB
&gt;&gt; Total execute time: 232565
</code></pre>

<p>Bỏ dòng <strong>slots</strong> = [&lsquo;name&rsquo;, &lsquo;age&rsquo;, &lsquo;address&rsquo;] đi thử</p>

<pre><code class="language-python">
class DataItem(object):
    def __init__(self, name, age, address):
        self.name = name
        self.age = age
        self.address = address


data = []

tracemalloc.start()
start =datetime.datetime.now()
for p in range(100000):
    data.append(DataItem(&quot;Alex&quot;, 42, &quot;middle of nowhere&quot;))
end =datetime.datetime.now()
snapshot = tracemalloc.take_snapshot()
top_stats = snapshot.statistics('lineno')
total = sum(stat.size for stat in top_stats)
print(&quot;Total allocated size: %.1f MB&quot; % (total / (1024*1024)))
print(&quot;Total execute time:&quot;,(end-start).microseconds)

&gt;&gt; Total allocated size: 16.8 MB
&gt;&gt; Total execute time: 240772
</code></pre>

<p>So sánh thử, chúng ta thấy rằng số lượng RAM giảm đi khá nhiều, thời gian thực thi khá tương đương nhau (có giảm một chút).</p>

<p>Cảm ơn các bạn đã theo dõi. Hẹn gặp bạn ở các bài viết tiếp theo.</p>

	<div style="    margin: 0;
    border-bottom: 1px dotted #d9d9d9;
    padding-bottom: 20px;"></div>
	<div><i class='fas fa-donate'>Nếu bạn thấy nội dung của bài viết thật sự hữu ích và bạn muốn đóng góp cho blog để có thêm nhiều bài viết chất lượng hơn nữa, các bạn có thể ủng hộ blog bằng một cốc trà hoặc một cốc cà phê nhỏ qua <a target="_blank" href="https://nhantien.momo.vn/7abl2tSivGa"> https://nhantien.momo.vn/7abl2tSivGa</a> hoặc <a  target="_blank" href="paypal.me/tungduypham">paypal.me/tungduypham</a>. Sự ủng hộ của các bạn là nguồn động viên quý giá để chúng tôi có thêm động lực và chia sẻ nhiều điều mà chúng tôi tìm hiểu được đến với cộng đồng. Trân trọng cảm ơn.<i></div>
  </div>
  
		
  <footer class="col-md-10  mx-auto">
  <ul class="stats list-unstyled">
 
    
  <li class="tags">
    <ul class="list-inline">
       
            
            
                <i class="fa fa-tags"></i>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/machine-learning">Machine learning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/deeplearning">Deeplearning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/python">python</a></li>
                
            
        
    </ul>
  </li>
  
</ul>

  <div class="fb-like" data-share="true"  data-width="800"  data-show-faces="true">
</div>
    
  </footer>
  <hr/>
<div class="infinite-container featured-task col-md-8 mx-auto">
<div class="titlerelate">Bài viết khác</div>

<div class="card-deck card-break infinite-item">



    
        <div class="card  col-md-6" style="padding-top:15px;">
		<a href="/blog/2019-02-05-5-python-tricks-you-need-to-know-today/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="/thumbnails/python_range.jpg" width="100" />
		<div class="card-body">
		<h5 class="card-title">
		5 mẹo hay sử dụng python
				</h5>
				</div>
				</a>
				</div>
    

    
        <div class="card  col-md-6"  style="padding-top:15px;">
		<a href="/blog/2019-02-06-choosing-the-right-hyperparameters-for-a-simple-lstm-using-keras/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="/thumbnails/choose_hyperparameter.jpg" width="100" />
		
		<div class="card-body">
		<h5 class="card-title">
		Lựa chọn siêu tham số cho mô hình LSTM đơn giản sử dụng Keras
				</h5>
				</div>
				</a>
				</div>
    

</div>
</div>



<div class="fb-comments" data-href="" data-width="" data-numposts="5"></div>

    <article class="post">
        
        <div class="disqus-comments">                  
            <button id="show-comments" class="btn btn-warning" type="button">Show <span class="disqus-comment-count" data-disqus-url="blog/2019-02-06-how-to-reduce-memory-consumption-by-half-by-adding-just-one-line-of-code">comments</span></button>
            <div id="disqus_thread"></div>
          </div>
    </article>





		
    </main>
    
<section id="sidebar" class="col-md-3">
<br/>
<div>
		<ul class="list-group" id="news-contents"></ul>
    <div id="calander">
	</div>
    </div>

  
   
  
  
  
  
  
  
  
  
 

</section>

</div>
	</div>
    
	<hr>
  <footer class="footer">
  <div class="container text-center">
    
    <p class="copyright">
      
        This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
      
     
    </p>
	</div>
	

      <div id="fb-root"></div>
      <script>
        window.fbAsyncInit = function() {
          FB.init({
            xfbml            : true,
            version          : 'v10.0'
          });
        };

        (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/vi_VN/sdk/xfbml.customerchat.js';
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));</script>

      
      <div class="fb-customerchat"
        attribution="setup_tool"
        page_id="1244186728962161">
      </div>
  </footer>
    
    

    
      
    

    
      
      
      
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
        
        
        
        <script  src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages/python.min.js"></script>
        <script defer="defer" async="async">hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
    <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
     

   <script  src="/js/jquery-2.2.4.min.js" data-cfasync="false"></script>
   
    <script defer="defer" async="async" src="/js/bootstrap.min.js"></script>
      <script defer="defer" async="async" src="/js/util.js"></script>
	  
      <script defer="defer"  src="/js/main.js"></script>
     
    

    
      
        
      
    
	
    
    
      

<script defer="defer" async="async" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script  defer="defer" async="async" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


	  
	  
	   

<script id="dsq-count-scr" src="//phamduytung.disqus.com/count.js" async></script>

 <script defer="defer"   src="/js/jquery.amlich.js" data-cfasync="false" ></script>
	   <script defer="defer"   type="text/javascript"  data-cfasync="false">

  function getcontent(){
 

   

           
                }
            
			
			$(document).ready(function(){
      getcontent();
      $('#calander').amLich({
  type: 'calendar', 
  tableWidth: '100%' 
});
  

			}); 
			
			
			$(function(){
  $('#show-comments').on('click', function(){
    var disqus_shortname = 'phamduytung';

    (function() {
      var disqus = document.createElement('script'); 
      disqus.type = 'text/javascript'; 
      disqus.async = true;
      disqus.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(disqus);
    })();

    $(this).hide(); 
  });
});

var disqus_config = function () {
  this.page.url = 'blog\/2019-02-06-how-to-reduce-memory-consumption-by-half-by-adding-just-one-line-of-code';
};
</script>


 


  </body>
</html>

