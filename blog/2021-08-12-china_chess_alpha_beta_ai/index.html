<!DOCTYPE HTML>

<html>

    <head>

	<script defer="defer" async="async" src="https://www.googleoptimize.com/optimize.js?id=OPT-52RT2BV"></script>
        <script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "/"
        },
        "articleSection" : "blog",
        "name" : "Xây dựng chương trình AI đơn giản cho game cờ tướng",
        "headline" : "Xây dựng chương trình AI đơn giản cho game cờ tướng",
        "description" : "Hướng dẫn xây dựng chương trình AI đơn giản cho game cờ tướng sử dụng  minimax và cắt tỉa alpha, beta. Sử dụng html với javascript và package http-server của nodejs",
        "inLanguage" : "en",
        "author" : "alexblack2202@gmail.comPhạm Duy Tùng",
        "creator" : "alexblack2202@gmail.comPhạm Duy Tùng",
        "publisher": "alexblack2202@gmail.comPhạm Duy Tùng",
        "accountablePerson" : "alexblack2202@gmail.comPhạm Duy Tùng",
        "copyrightHolder" : "alexblack2202@gmail.comPhạm Duy Tùng",
        "copyrightYear" : "2021",
        "datePublished": "2021-08-12 00:19:00 &#43;0300 &#43;0300",
        "dateModified" : "2021-08-12 00:19:00 &#43;0300 &#43;0300",
        "url" : "/blog/2021-08-12-china_chess_alpha_beta_ai/",
        "wordCount" : "1888",
        "keywords" : [ "machine learning","ai","china chess","cờ tướng","minimax","alpha beta pruning","Blog" ]
    }
    </script>
        
            
                <title>Xây dựng chương trình AI đơn giản cho game cờ tướng</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        
		<meta name="generator" content="Phạm Duy Tùng" />
        <meta property="fb:pages" content="1244186728962161" />

        
  
    
  

  

  
  
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile.png'>
  <meta name="application-name" content="Phạm Duy Tùng Machine Learning Blog">
  <meta name="msapplication-tooltip" content="Blog ML của Phạm Duy Tùng và Đặng Thị Hằng">
   
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">



        
            <meta name="author" content="Phạm Duy Tùng">
        
        
            <meta name="description" content="Hướng dẫn xây dựng chương trình AI đơn giản cho game cờ tướng sử dụng  minimax và cắt tỉa alpha, beta. Sử dụng html với javascript và package http-server của nodejs">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Xây dựng chương trình AI đơn giản cho game cờ tướng"/>
<meta name="twitter:description" content="Hướng dẫn xây dựng chương trình AI đơn giản cho game cờ tướng sử dụng  minimax và cắt tỉa alpha, beta. Sử dụng html với javascript và package http-server của nodejs"/>
<meta name="twitter:site" content="@example"/>

        <meta property="og:title" content="Xây dựng chương trình AI đơn giản cho game cờ tướng" />
<meta property="og:description" content="Hướng dẫn xây dựng chương trình AI đơn giản cho game cờ tướng sử dụng  minimax và cắt tỉa alpha, beta. Sử dụng html với javascript và package http-server của nodejs" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2021-08-12-china_chess_alpha_beta_ai/" /><meta property="article:published_time" content="2021-08-12T00:19:00&#43;03:00"/>
<meta property="article:modified_time" content="2021-08-12T00:19:00&#43;03:00"/>

        <meta property="og:image" content="//images/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="512">
        
<meta itemprop="name" content="Xây dựng chương trình AI đơn giản cho game cờ tướng">
<meta itemprop="description" content="Hướng dẫn xây dựng chương trình AI đơn giản cho game cờ tướng sử dụng  minimax và cắt tỉa alpha, beta. Sử dụng html với javascript và package http-server của nodejs">


<meta itemprop="datePublished" content="2021-08-12T00:19:00&#43;03:00" />
<meta itemprop="dateModified" content="2021-08-12T00:19:00&#43;03:00" />
<meta itemprop="wordCount" content="1888">



<meta itemprop="keywords" content="machine learning,ai,china chess,cờ tướng,minimax,alpha beta pruning," />

        

        
            
        

        
        
          
			 <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">


          
            
        

        
            
                
            
        


  
    
    <link href='//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/styles/xcode.min.css' rel='stylesheet' type='text/css' />
  


      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-114911596-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

	  <style>
	  
	  body{
font-family: Helvetica,Arial,sans-serif;
}

.card{
	margin-bottom: 10px;
}

#disqus_thread{
padding: 0 5px;
}

.item-header{
padding: 0;
}

.single-content-img{
width: 100%;
    max-height: 450px !important;
    background-size: cover;
    display: block;
    background-position: center;
}

.thumbnail {
    position: relative;
}

.caption {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
	background: rgba(0, 0, 0, 0.25);
	text-align:left;
}

.caption .title{
	font-size: 1.6em;
    line-height: 1.4em;
    top: 0;
	margin-left:20px;
	margin-top:20px;
	
}

.caption .title-caption{
margin-left:10px;
}

#content p{
text-align: justify;
    font-size: 16px;
    <!-- color: #333;-->	
    line-height: 28px;
}

#content img{
	display: block;
    margin-left: auto;
margin-right: auto;
max-width:98%;
}

img + strong {
    font-style: normal;
    display: inherit;
    text-align: center;
}
.img-news{
max-height:150px;
width:100%;
}

.news-tittle{
	padding-top:15px;
	text-align:justify;
}

.author{
	color: orange;
}
.author-inline{
	color: orange;
}

.adv{
height:18px;
}


.hljs{
    white-space: pre-wrap;
    white-space: -moz-pre-wrap;
    white-space: -pre-wrap;
    white-space: -o-pre-wrap;
    word-wrap: break-word;}
.titledetail {
    display: block;
    overflow: hidden;
    line-height: 53px;
    font-size: 45px;
    font-family: 'Roboto Condensed',sans-serif;
    font-weight: 600;

    margin: auto;
	padding: 0 ;
}

.newsrelate {
    display: block;
    overflow: hidden;
	 list-style:none;
}
a ,a:hover{
    text-decoration: none;
}
.newsrelate li {
    float: left;
    overflow: hidden;
    width: 30%;
    margin-left: 2.5%;
    margin-bottom: 15px;
}

.newsrelate li a {
    display: block;
    overflow: hidden;
}

.userdetail {
    display: block;
    overflow: hidden;
    margin: 0 10px 0 0;
    padding: 15px 0;
}
.newsrelate li h3 {
    display: block;
    overflow: hidden;
    line-height: 1.3em;
    font-size: 16pt;
    line-height: 22px;
    font-weight: 300;
    font-family: Arial,Helvetica,sans-serif;
    width: auto;
    margin: 5px auto;
}

.titlerelate {
    overflow: hidden;
    font-size: 18px;
    font-weight: 600;
    font-family: 'Roboto Condensed',sans-serif;
    line-height: 32px;
    text-transform: uppercase;
}
article .captionnews {
    color: #999;
    font-size: 14px;
    font-style: italic;
    padding: 10px;
    text-align: center;
    margin-bottom: 15px;
}

.bgtrans h1 {
    display: block;
    overflow: hidden;
    font-size: 45px;
    line-height: 55px;
    margin: auto;
    left: 0;
    right: 0;
    bottom: 50px;
    font-family: 'Roboto Condensed',sans-serif;
    font-weight: 600;
}

.bgcover {
    display: block;
    overflow: hidden;
    height: 450px;
    background: no-repeat center center;
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
    position: relative;
    margin-bottom: -65px;
}
.bgcover .bgtrans .userdetail {
    width: 800px;
    margin: auto;
    position: absolute;
    left: 0;
    right: 0;
    bottom: 10px;
}
.userdetail {
    display: block;
    overflow: hidden;
    margin: 0 10px 0 0;
    padding: 15px 0;
}

.amlich{border-collapse:collapse;font-size:14px;font-family:Roboto,sans-serif}.calendar{font-size:12px}.calendar td{background-color:#e9eff3}.calendar-month{background-color:#1e8cbe!important;color:#fff;text-shadow:0 0 3px #000;padding:6px;font-weight:700;text-transform:uppercase;font-size:14px!important}.amlich-tennam{text-align:center;font-weight:700;color:#000;background-color:#ccc;font-size:14px;font-family:Roboto,sans-serif}.amlich .calendar-month,.amlich .calendar-b-left,.amlich .calendar-b-right{text-align:center;padding:4px 0;font-size:11px}.amlich .calendar-day{text-align:center;font-weight:700}.amlich .calendar-day .day-num{font-size:80px;font-family:Roboto,sans-serif;line-height:100%;color:#31708f}.amlich .lunar-day-num{font-size:44px;line-height:100%;font-weight:700;color:#3c763d}.amlich .calendar-holiday,.amlich .calendar-hoangdao{padding:0 4px 4px;font-size:11px;text-align:center}.amlich .calendar-holiday{color:#a94442;font-weight:700}.amlich a{text-decoration:none;color:#fff}.amlich a:hover{color:red}.amlich .tenthang,.amlich .navi-l,.amlich .navi-r{text-align:center;padding:6px;background-color:#1e8cbe;color:#fff;font-weight:700}.amlich .tenthang{text-shadow:0 0 3px #000}.amlich .navi-l{font-size:12px}.amlich .navi-r{font-size:12px}.amlich .ngaytuan{text-align:center;color:#303;background-color:#ddd;padding:3px;width:14.286%;font-size:10px;font-weight:700}.amlich .ngaythang,.amlich .homnay,.amlich .tet,.amlich .leam,.amlich .leduong{cursor:pointer;border-bottom:solid 1px #eee;padding:3px;width:14.286%}.amlich .ngaythang div,.amlich .homnay div,.amlich .tet div,.amlich .leam div,.amlich .leduong div{line-height:110%}.amlich .ngaythang{color:#5a5c5b}.amlich tr:nth-child(odd) td.ngaythang:nth-child(odd){background-color:#f9f9f9}.amlich tr:nth-child(odd) td.ngaythang:nth-child(even){background-color:#fff}.amlich tr:nth-child(even) td.ngaythang:nth-child(odd){background-color:#fff}.amlich tr:nth-child(even) td.ngaythang:nth-child(even){background-color:#f9f9f9}.amlich tr td.ngaythang:hover{background-color:#f5f5f5!important}.amlich .homnay{background-color:#fcf8e3;color:#fff}.amlich .homnay:hover{background-color:#faf2cc}.amlich .tet{background-color:#f2dede}.amlich .tet:hover{background-color:#ebcccc}.amlich .leam{background-color:#d9edf7}.amlich .leam:hover{background-color:#c4e3f3}.amlich .leduong{background-color:#dff0d8}.amlich .leduong:hover{background-color:#d0e9c6}.amlich .am{text-align:right;font-size:75%;color:#554c00}.amlich .am2{text-align:right;font-size:75%;color:#337ab7;font-weight:700}.amlich .t2t6{text-align:left;color:#5a5c5b;font-weight:700}.amlich .t7{font-weight:700;text-align:left;color:blue}.amlich .cn{font-weight:700;text-align:left;color:red}
	  </style>

    </head>
    <body class="text-dark bg-light">
<script  async defer>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1546237302193677',
      xfbml      : true,
      version    : 'v5.0'
    });
    FB.AppEvents.logPageView();
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v5.0&appId=1853483258232756&autoLogAppEvents=1"></script>
      
      

    
    
<header id="header"  style="background: #790014; color: hsla(0,0%,100%,1);">
<div class="container">
    <nav class="navbar navbar-expand-md navbar-dark">
	
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            
                <li class="nav-item">
                    <a class='nav-link' href="/blog">
                            <i class="fa fa-home active">&nbsp;</i>Home
                    </a>
                </li>
            
        </ul>
    </nav>
    </div></div>
</header>


   
    
	<div class="container">
	<div class="adv"></div>
	<div class="row">
    <main role="main"  class="col-md-9 border-right" >
	
        
        
          


        
		 <div class="header">
           
		<div class="bgtrans">
		 <h1 class="titledetail">Xây dựng chương trình AI đơn giản cho game cờ tướng</h1>
		<div class="userdetail">
			 
			  <time class="published" 
            datetime='2021-08-12'>
            12/08/2021</time>
		 - 
			   <span class="author">Phạm Duy Tùng</span>
			   
			</div>	
		
			</div>
			</div>
  <div class="fb-like" data-share="true"  data-width="800"  data-show-faces="true">
</div>
			
		
		
			 
            
        
       



  

  
 
  <div style="    margin: 0;
    border-bottom: 1px dotted #d9d9d9;
    padding-bottom: 20px;"></div>
  <div id="content">
    

<h1 id="giới-thiệu">Giới thiệu</h1>

<p>Cờ tướng là một môn thể thao khá phổ biến ở Việt Nam. Các bạn có thể bắt gặp các bàn cờ ở các con hẻm của mỗi góc phố. Hoặc là khi các bộ bàn ghế đá thì người mua cũng thường nhờ thợ khắc lên bàn cờ tướng để hàng xóm láng giềng giải trí ngày cuối tuần. Trong bài viết này, mình sẽ hướng dẫn step by step ứng dụng chơi game cờ tướng đơn giản với một chút AI. Hi vọng sẽ giúp được các bạn trên con đường thực hành máy học.</p>

<p>Các việc cần làm:</p>

<ul>
<li><p>Tạo bàn cờ và sinh nước đi</p></li>

<li><p>Lượng giá bàn cờ</p></li>

<li><p>Áp dụng minimax</p></li>

<li><p>Áp dụng cắt tỉa alpha, beta</p></li>
</ul>

<p>Bạn có thể chơi thử game cờ tướng mình có post ở đây:  <a href="https://www.phamduytung.com/games/china_chess/">https://www.phamduytung.com/games/china_chess/</a></p>

<h1 id="bước-1-tạo-bàn-cờ-và-sinh-nước-đi">Bước 1: Tạo bàn cờ và sinh nước đi</h1>

<p>Mình không có gỏi lắm trong việc thiết kế mấy icon cho mấy con tướng, sĩ, tượng. Ngoài ra, công việc chính của chúng ta là phần làm sao cho máy tự đánh được, nên phần này mình sẽ xài các open source có sẵn, lượn lờ một chút trên mạng thì mình đã lụm được cái bàn cờ ở link <a href="https://github.com/lengyanyu258/xiangqiboardjs">https://github.com/lengyanyu258/xiangqiboardjs</a> và thư viện sinh nước đi xiangqi.js. Thư viện xiangqi.js đã có sẵn các hàm kiểm tra tính hợp lệ của nước đi, nên mình chỉ việc lấy ra rồi dùng thôi, khỏi mất công phải viết lại.</p>

<p>Bàn cờ được chia làm 2 đội, là đội đen (black, ký hiệu b) và đội đỏ (red , ký hiệu r), mỗi đội gồm 16 quân, bao gồm 1 con tướng (General  hoặc king , ký hiệu k), 2 con sỹ (Advisor hoặc guards,  ministers, ký hiệu là a), 2 con tượng (Elephants hoặc bishops - ký hiệu là b), 2 con mã (Horses hoặc knights - ký hiệu là n, do chữ k trùng với king là con tướng, nên người ta xài chữ n), 2 con xe (Chariot hoặc rooks - ký hiệu là r), 2 con pháo (canons, ký hiệu là c ), 5 con chốt (Soldiers , ký hiệu là p ( do con chốt ở cờ đen và cờ đỏ có phiên âm tiếng trung khác nhau, chốt cờ đen đọc gần giống chữ &ldquo;zú&rdquo; (&ldquo;pawn&rdquo; hoặc &ldquo;private&rdquo; - tiếng anh), còn chốt cờ đỏ đọc là bing (&ldquo;soldier&rdquo; - tiếng anh) )).</p>

<p>Tổng cộng, ta có tướng, sỹ, tượng, mã, xe, pháo, chốt, 7 loại quân, tương đương với 7 ký hiệu, tổ hợp với 2 đội là đỏ và đen, tổ hợp với nhau, ta xác định được</p>

<p><img src="/post_image/china_chess_base_board.png" alt="AI Cờ tướng - Bàn cờ gốc" /></p>

<p>Để bắt đầu, chúng ta sẽ code một hàm random bước đi đơn giản. Hàm có nhiệm vụ lấy ngẫu nhiên một bước đi trong danh sách các bước có thể đi, sau đó máy sẽ đánh bước đi đó.</p>

<pre><code class="language-javascript">

function makeRandomMove () {
  let possibleMoves = game.moves();

  // game over
  if (possibleMoves.length === 0) return; // Không còn nước nào có thể đi, end game

  let randomIdx = Math.floor(Math.random() * possibleMoves.length); // bốc đại 1 nước đi trong danh sách các bước có thể đi
  game.move(possibleMoves[randomIdx]);
  board.position(game.fen());
}


</code></pre>

<p><img src="/post_image/china_chess_simple_move.gif" alt="AI Cờ tướng - đi ngẫu nhiên" /></p>

<p>Do thuật toán chúng ta cho máy chạy khá là ngốc, nên nó đánh cũng hơi ngốc. :)</p>

<h1 id="bước-2-hàm-lượng-giá">Bước 2: Hàm lượng giá</h1>

<p>Dựa vào mức độ cơ động, tầm quang trọng của mỗi quân lính trên bàn cờ, chúng ta sẽ gán cho mỗi quân cờ một trọng số khác nhau thể hiện điều đó.</p>

<p>Ví dụ, chúng ta set các trọng số như sau:</p>

<p>tướng của ta là 900 điểm, tướng của đối thủ là -900 điểm</p>

<p>sỹ của ta là 20 điểm, sỹ của đối thủ là -20 điểm</p>

<p>tượng của ta là 20 điểm, tượng của đối thủ là -20 điểm</p>

<p>mã của ta là 40 điểm, mã của đối thủ là -40 điểm</p>

<p>xe của ta là 90 điểm, xe của đối thủ là -90 điểm</p>

<p>pháo của ta là 45 điểm, pháo của đối thủ là -45 điểm</p>

<p>chốt của ta là 15 điểm, chốt của đối thủ là -15 điểm</p>

<p>Hàm lượng giá ở trên khá ngây thơ, mọi quân cờ đều có điểm ngang nhau, không quan tâm vị trí đứng của nó.</p>

<p>Trên thực tế, chúng ta thấy rằng, con tướng ở vị trí trung tâm thường là an toàn nhất, một khi  tướng leo lên lầu 1 hoặc leo lầu 2, nghĩa là con tướng có khả năng bị đột tử cao hơn, nên chúng ta phải tinh chỉnh lại điểm của con tướng trong trường hợp này.</p>

<p>Một ví dụ nữa là vị trí con mã, mã gần với thành của tướng địch hơn thì khả năng con xe chiếu bí tướng địch sẽ cao hơn con mã chưa qua sông.</p>

<p>Giá trị lượng giá cho cờ tướng, các bạn có thể tham khảo ở link <a href="https://github.com/markdirish/xiangqi/blob/master/evaluate.js">https://github.com/markdirish/xiangqi/blob/master/evaluate.js</a></p>

<p>Chúng ta sẽ duyệt lần lượt từ trái qua phải, từ trên xuống dưới, tính điểm của bàn cờ hiện tại.</p>

<p>Hàm lượng giá của bàn cờ xét như sau:</p>

<pre><code class="language-javascript">


function evaluateBoard(board) {
  var totalEvaluation = 0;
  for (var i = 0; i &lt; 10; i++) {
    for (var j = 0; j &lt; 9; j++) {
      totalEvaluation = totalEvaluation + getPieceValue(board[i][j], i ,j);
    }
  }
  return totalEvaluation;
}



function getPieceValue(piece, x, y) {
  if (piece === null) {
    return 0;
  }
  var getAbsoluteValue = function (piece, isRed, x ,y) {
    if (piece.type === 'p') { //chốt
      return 15 + ( isRed ? pEvalRed[x][y] : pEvalBlack[x][y] );
    } else if (piece.type === 'r') { //Xe
      return 90 +( isRed ? rEvalRed[x][y] : rEvalBlack[x][y] );
    } else if (piece.type === 'c') { //pháo
      return 45 +( isRed ? cEvalRed[x][y] : cEvalBlack[x][y] );
    } else if (piece.type === 'n') { // mã
      return 40 +( isRed ? nEvalRed[x][y] : nEvalBlack[x][y] );
    } else if (piece.type === 'b') { // tượng
      return 20 +( isRed ? bEvalRed[x][y] : bEvalBlack[x][y] );
    } else if (piece.type === 'a') { // sỹ
      return 20 +( isRed ? aEvalRed[x][y] : aEvalBlack[x][y] );
    } else if (piece.type === 'k') { // tướng
      return 900 +( isRed ? kEvalRed[x][y] : kEvalBlack[x][y] );
    }
    throw &quot;Unknown piece type: &quot; + piece.type;
  };

  var absoluteValue = getAbsoluteValue(piece, piece.color === 'r', x ,y);
  return piece.color === 'r' ? absoluteValue : -absoluteValue;
}
</code></pre>

<p>Bây giờ, chúng ta chỉ cần duyệt qua toàn bộ các nước có thể đi, tính xem nước đi nào có điểm số là lớn nhất, thì máy sẽ đi theo nước đi đó.</p>

<pre><code class="language-javascript">

function getBestMove(game) {

var newGameMoves = game.moves();
var bestMove = null;
// set đại một số âm vô hạn
var bestValue = -9999;

for (var i = 0; i &lt; newGameMoves.length; i++) {
    var newGameMove = newGameMoves[i];
    game.move(newGameMove);

    var boardValue = -evaluateBoard(game.board())
    game.undo();
    if (boardValue &gt; bestValue) {
        bestValue = boardValue;
        bestMove = newGameMove
    }
}

return bestMove;

};

</code></pre>

<p>Vì vậy, ngoài việc xét điểm cho các loại quân, chúng ta sẽ có một bảng xét điểm cho các con</p>

<p><img src="/post_image/china_chess_evaluation.gif" alt="AI Cờ tướng - Chọn nước đi tốt nhất" /></p>

<p>Kết quả có vẻ tốt hơn so với việc random bước đi trước đó, nhưng thuật toán vẫn còn hơi dốt dốt xíu,  do máy chỉ tính 1 nước đi và chọn ra nước đi tốt nhất. Nên máy chưa có cái nhìn dài hơn. Có nhiều cách để cho máy có thể có góc nhìn xa hơn về thế cục của bàn cờ, một trong các cách được giới thiệu ở đây là sử dụng minimax</p>

<h1 id="bước-3-tìm-kiếm-cây-sử-dụng-minimax">Bước 3. Tìm kiếm cây sử dụng minimax</h1>

<p>Thuật toán minimax thuộc nhóm duyệt theo chiều sâu (depth first search). Hai người chơi, một người được gọi là MAX, người còn lại gọi là MIN. Thuật toán được thiết kế để tìm nước đi tối ưu cho người MAX. Người MAX sẽ giữ node gốc, lần lượt duyệt đệ quy qua tất cả các node con theo chiều sâu nhất định đến khi duyệt qua tất cả các node hoặc là tìm được một đường đi mà đạt MAX.</p>

<p>Chi tiết hơn, người MAX sẽ đi đầu tiên. Nhiệm vụ của MAX là tìm nước đi sao cho điểm số của mình là cao nhất, nhiệm vụ của MIN là tìm nước đi để cực tiểu hoá điểm số của MAX.</p>

<p>Các bạn có thể đọc thêm ở link <a href="https://en.wikipedia.org/wiki/Minimax">https://en.wikipedia.org/wiki/Minimax</a>.</p>

<p>Để triển khai minimax, đầu tiên, chúng ta sẽ sửa lại hàm getBestMove ở trên, thay vì gọi lượng giá bàn cờ evaluateBoard, chúng ta sẽ gọi hàm minimax</p>

<pre><code class="language-javascript">

function minimaxRoot(depth, game, isMaximisingPlayer) {
  var newGameMoves = game.moves();
  var bestMove = -9999;
  var bestMoveFound;

  for(var i = 0; i &lt; newGameMoves.length; i++) {
    var newGameMove = newGameMoves[i]
    game.move(newGameMove);
    var value = minimax(depth - 1, game, !isMaximisingPlayer);
    game.undo();
    if(value &gt;= bestMove) {
      bestMove = value;
      bestMoveFound = newGameMove;
    }
  }
  return bestMoveFound;
}


</code></pre>

<p>với hàm minimax cũng cùng ý tưởng với hàm getBestMove ở trên, nhưng ta sẽ gọi đệ quy, luân phiên tính điểm máy, sau đó tính điểm người &hellip; theo độ sâu ta đã thiết lập, để tìm ra đường đi có số điểm là lớn nhất.</p>

<pre><code class="language-javascript">
function minimax (depth, game, isMaximisingPlayer) {
    if (depth === 0) {
        return -evaluateBoard(game.board());
    }
    var newGameMoves = game.moves();
    if (isMaximisingPlayer) {
        var bestMove = -9999;
        for (var i = 0; i &lt; newGameMoves.length; i++) {
            game.move(newGameMoves[i]);
            bestMove = Math.max(bestMove, minimax(depth - 1, game, !isMaximisingPlayer));
            game.undo();
        }
        return bestMove;
    } else {
        var bestMove = 9999;
        for (var i = 0; i &lt; newGameMoves.length; i++) {
            game.move(newGameMoves[i]);
            bestMove = Math.min(bestMove, minimax(depth - 1, game, !isMaximisingPlayer));
            game.undo();
        }
        return bestMove;
    }
};

</code></pre>

<p>Thuật toán này hoạt động khá hiệu quả, nhưng có một điểm yếu là nó sẽ vét cạn toàn bộ các trường hợp để tìm ra đường đi tối ưu nhất. Vì vậy, với giá trị độ sâu càng lớn thì thuật toán chạy càng chậm.</p>

<h1 id="bước-4-cắt-tỉa-alpha-beta">Bước 4: Cắt tỉa Alpha - Beta</h1>

<p>Cắt tỉa Alpha - Beta là một phương pháp tối ưu hoá của thuật toán minimax, phương pháp này giúp chúng ta bỏ qua một vài nhánh trong quá trình tìm kiếm, làm giới hạn phạm vi tìm kiếm, giúp mô hình hoạt động nhanh hơn.</p>

<p>Thuật toán sẽ hoạt động hiệu quả hơn nếu những bước tìm kiếm đầu tiên là những nước đi tốt nhất :)</p>

<p>Hàm minimax với alpla, beta được viết lại như sau</p>

<pre><code class="language-javascript">


function minimax(depth, game, alpha, beta, isMaximisingPlayer) {
  positionCount++;
  if (depth === 0) {
    return -evaluateBoard(game.board());
  }

  var newGameMoves = game.moves();

  if (isMaximisingPlayer) {
    var bestMove = -9999;
    for (var i = 0; i &lt; newGameMoves.length; i++) {
      game.moves(newGameMoves[i]);
      bestMove = Math.max(bestMove, minimax(depth - 1, game, alpha, beta, !isMaximisingPlayer));
      game.undo();
      alpha = Math.max(alpha, bestMove);
      if (beta &lt;= alpha) {
        return bestMove;
      }
    }
    return bestMove;
  } else {
    var bestMove = 9999;
    for (var i = 0; i &lt; newGameMoves.length; i++) {
      game.moves(newGameMoves[i]);
      bestMove = Math.min(bestMove, minimax(depth - 1, game, alpha, beta, !isMaximisingPlayer));
      game.undo();
      beta = Math.min(beta, bestMove);
      if (beta &lt;= alpha) {
        return bestMove;
      }
    }
    return bestMove;
  }
}


</code></pre>

<p><img src="/post_image/china_chess_maxmin.gif" alt="AI Cờ tướng với cắt tỉa alpha-beta Minimax" /></p>

<p>Cảm ơn các bạn đã theo dõi bài viết. Xin chào và hẹn gặp lại các bạn ở bài viết kế tiếp.</p>

<p>Các bạn có thể chơi game ở đây nha , link <a href="https://www.phamduytung.com/games/china_chess/">https://www.phamduytung.com/games/china_chess/</a></p>

<p>Mình sẽ update dần giao diện để cho game trở nên đẹp đẹp hơn.</p>

	
	<div><i class='fas fa-donate'>Nếu bạn thấy nội dung của bài viết thật sự hữu ích và muốn đóng góp cho block để có thêm nhiều bài viết chất lượng hơn nữa, các bạn có thể ủng hộ block bằng một cốc trà hoặc một cốc cà phê nhỏ qua <a target="_blank" href="https://nhantien.momo.vn/7abl2tSivGa"> https://nhantien.momo.vn/7abl2tSivGa</a> hoặc <a  target="_blank" href="paypal.me/tungduypham">paypal.me/tungduypham</a>. Sự ủng hộ của các bạn là nguồn động viên quý giá để chúng tôi có thêm động lực và chia sẻ nhiều điều chúng tôi tìm hiểu được với cộng đồng. Trân trọng cảm ơn<i></div>
  </div>
  
		
  <footer class="col-md-10  mx-auto">
  <ul class="stats list-unstyled">
 
    
  <li class="tags">
    <ul class="list-inline">
       
            
            
                <i class="fa fa-tags"></i>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/machine-learning">machine learning</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/ai">ai</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/china-chess">china chess</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/c%E1%BB%9D-t%C6%B0%E1%BB%9Bng">cờ tướng</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/minimax">minimax</a></li>
                
                
                <li class="list-inline-item"><a class="article-category-link" href="/tags/alpha-beta-pruning">alpha beta pruning</a></li>
                
            
        
    </ul>
  </li>
  
</ul>

  <div class="fb-like" data-share="true"  data-width="800"  data-show-faces="true">
</div>
    
  </footer>
  <hr/>
<div class="infinite-container featured-task col-md-8 mx-auto">
<div class="titlerelate">Bài viết khác</div>

<div class="card-deck card-break infinite-item">



    
        <div class="card  col-md-6" style="padding-top:15px;">
		<a href="/blog/2021-07-28-pycaret-flaskapi/"
                class="button big previous">
		
		<img class="card-img-top lazy" src="/thumbnails/thumbnails.jpg" width="100" />
		<div class="card-body">
		<h5 class="card-title">
		Tìm hiểu package PyCaret trong python
				</h5>
				</div>
				</a>
				</div>
    

    

</div>
</div>



<div class="fb-comments" data-href="" data-width="" data-numposts="5"></div>

    <article class="post">
        
        <div class="disqus-comments">                  
            <button id="show-comments" class="btn btn-warning" type="button">Show <span class="disqus-comment-count" data-disqus-url="blog/2021-08-12-china_chess_alpha_beta_ai">comments</span></button>
            <div id="disqus_thread"></div>
          </div>
    </article>





		
    </main>
    
<section id="sidebar" class="col-md-3">
<br/>
<div>
		<ul class="list-group" id="news-contents"></ul>
    <div id="calander">
	</div>
    </div>

  
   
  
  
  
  
  
  
  
  
 

</section>

</div>
	</div>
    
	<hr>
  <footer class="footer">
  <div class="container text-center">
    
    <p class="copyright">
      
        This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
      
     
    </p>
	</div>
	

      <div id="fb-root"></div>
      <script>
        window.fbAsyncInit = function() {
          FB.init({
            xfbml            : true,
            version          : 'v10.0'
          });
        };

        (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = 'https://connect.facebook.net/vi_VN/sdk/xfbml.customerchat.js';
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));</script>

      
      <div class="fb-customerchat"
        attribution="setup_tool"
        page_id="1244186728962161">
      </div>
  </footer>
    
    

    
      
    

    
      
      
      
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/highlight.min.js"></script>
        
        
        
        <script  src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.8/languages/python.min.js"></script>
        <script defer="defer" async="async">hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
    <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
     

   <script  src="/js/jquery-2.2.4.min.js" data-cfasync="false"></script>
   
    <script defer="defer" async="async" src="/js/bootstrap.min.js"></script>
      <script defer="defer" async="async" src="/js/util.js"></script>
	  
      <script defer="defer"  src="/js/main.js"></script>
     
    

    
      
        
      
    
	
    
    
      

<script defer="defer" async="async" src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script  defer="defer" async="async" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


	  
	  
	   

<script id="dsq-count-scr" src="//phamduytung.disqus.com/count.js" async></script>

 <script defer="defer"   src="/js/jquery.amlich.js" data-cfasync="false" ></script>
	   <script defer="defer"   type="text/javascript"  data-cfasync="false">

  function getcontent(){
 

   

           
                }
            
			
			$(document).ready(function(){
      getcontent();
      $('#calander').amLich({
  type: 'calendar', 
  tableWidth: '100%' 
});
  

			}); 
			
			
			$(function(){
  $('#show-comments').on('click', function(){
    var disqus_shortname = 'phamduytung';

    (function() {
      var disqus = document.createElement('script'); 
      disqus.type = 'text/javascript'; 
      disqus.async = true;
      disqus.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(disqus);
    })();

    $(this).hide(); 
  });
});

var disqus_config = function () {
  this.page.url = 'blog\/2021-08-12-china_chess_alpha_beta_ai';
};
</script>


 


  </body>
</html>

